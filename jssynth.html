<!DOCTYPE html>
<html lang="en" ng-app="js120">
<head>
  <title>JS-120</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" media="all" href="jssynth.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
  <script src="lib/AudioContextMonkeyPatch.js"></script>
  <script src="src/app.js"></script>
  <script src="src/jssynth.js"></script>
  <script src="src/analytics.js"></script>
</head>
<body>
<div id="container">
  <h1 class="logo mt0 mb0">JS-120</h1>
  <span class="tagline">High Resolution Web Synthesizer</span>

  <div ng-controller="InstrumentCollectionController">
    <select ng-model="selectedInstrumentID" ng-change="changeSelectedInstrument();" convert-to-number>
      <option ng-repeat="instrumentOption in instrumentOptions" value="{{instrumentOption.id}}">{{instrumentOption.name}}</option>
    </select>
    <button class="block button-full right" ng-click="addInstrument();">Add</button>
  </div>

  <div ng-controller="InstrumentController">
    <div>
      <span class="control">
        <label class="control-label">Name: {{instrument.id}}</label>
        <input class="underlinedInput" ng-model="instrument.name" ng-change="updateInstrument();" type="text" />
      </span>
      <h2 class="section-header">Sound Generator</h2>
      <span class="control">
        <label class="control-label">Waveform:</label>
        <span class="flex waveformOptionsContainer">
          <span class="radioContainer">
            <input id="waveformSine" ng-model="instrument.waveform" ng-change="updateInstrument();" value="sine" type="radio">
            <label for="waveformSine" class="radioLabel">Sine</label>
          </span>
          <span class="radioContainer">
            <input id="waveformSquare" ng-model="instrument.waveform" ng-change="updateInstrument();" value="square" type="radio">
            <label for="waveformSquare" class="radioLabel">Square</label>
          </span>
          <span class="radioContainer">
            <input id="waveformSaw" ng-model="instrument.waveform" ng-change="updateInstrument();" value="sawtooth" type="radio">
            <label for="waveformSaw" class="radioLabel">Saw</label>
          </span>
          <span class="radioContainer">
            <input id="waveformTriangle" ng-model="instrument.waveform" ng-change="updateInstrument();" value="triangle" type="radio">
            <label for="waveformTriangle" class="radioLabel">Triangle</label>
          </span>
        </span>
      </span>
      <span class="sub-section-header">Pitch Wobble:</span>
      <span class="control">
        <label class="control-label indented">Amount:</label>
        <span class="annotated-input">
          <input ng-model="instrument.lfoAmplitude" ng-change="updateInstrument();" type="range" min="0" max="100" step="1" />
          <span>{{instrument.lfoAmplitude}}Hz</span>
        </span>
      </span>
      <span class="control">
        <label class="control-label indented">Rate:</label>
        <span class="annotated-input">
          <input ng-model="instrument.lfoFrequency" ng-change="updateInstrument();" type="range" min="0.0" max="20.0" step="0.1" />
          <span>{{instrument.lfoFrequency}}Hz</span>
        </span>
      </span>
      <span class="control">
        <label class="control-label indented">Waveform:</label>
        <span class="flex waveformOptionsContainer">
          <span class="radioContainer">
            <input id="lfoWaveformSine" ng-model="instrument.lfoWaveform" ng-change="updateInstrument();" value="sine" type="radio">
            <label for="lfoWaveformSine" class="radioLabel">Sine</label>
          </span>
          <span class="radioContainer">
            <input id="lfoWaveformSquare" ng-model="instrument.lfoWaveform" ng-change="updateInstrument();" value="square" type="radio">
            <label for="lfoWaveformSquare" class="radioLabel">Square</label>
          </span>
          <span class="radioContainer">
            <input id="lfoWaveformSaw" ng-model="instrument.lfoWaveform" ng-change="updateInstrument();" value="sawtooth" type="radio">
            <label for="lfoWaveformSaw" class="radioLabel">Saw</label>
          </span>
          <span class="radioContainer">
            <input id="lfoWaveformTriangle" ng-model="instrument.lfoWaveform" ng-change="updateInstrument();" value="triangle" type="radio">
            <label for="lfoWaveformTriangle" class="radioLabel">Triangle</label>
          </span>
        </span>
      </span>
    </div>
    <div>
      <h2 class="section-header">Filter</h2>
      <span class="control">
        <label class="control-label">Cutoff:</label>
        <span class="annotated-input">
          <input ng-model="instrument.filterCutoff" ng-change="updateInstrument();" type="range" min="50" max="9950" step="50" />
          <span>{{instrument.filterCutoff}}Hz</span>
        </span>
      </span>
      <span class="control">
        <label class="control-label">Resonance:</label>
        <span class="annotated-input">
          <input ng-model="instrument.filterResonance" ng-change="updateInstrument();" type="range" min="0" max="20" step="1.0" />
          <span>{{instrument.filterResonance}}</span>
        </span>
      </span>
      <span class="sub-section-header">Cutoff Wobble:</span>
      <span class="control">
        <label class="control-label indented">Amount:</label>
        <span class="annotated-input">
          <input ng-model="instrument.filterLFOAmplitude" ng-change="updateInstrument();" type="range" min="0.0" max="1.0" step="0.01" />
          <span>{{(instrument.filterLFOAmplitude * 100) | number:0}}%</span>
        </span>
      </span>
      <span class="control">
        <label class="control-label indented">Rate:</label>
        <span class="annotated-input">
          <input ng-model="instrument.filterLFOFrequency" ng-change="updateInstrument();" type="range" min="0.0" max="20.0" step="0.1" />
          <span>{{instrument.filterLFOFrequency}}Hz</span>
        </span>
      </span>
      <span class="control">
        <label class="control-label indented">Waveform:</label>
        <span class="flex waveformOptionsContainer">
          <span class="radioContainer">
            <input id="filterLFOWaveformSine" ng-model="instrument.filterLFOWaveform" ng-change="updateInstrument();" value="sine" type="radio">
            <label for="filterLFOWaveformSine" class="radioLabel">Sine</label>
          </span>
          <span class="radioContainer">
            <input id="filterLFOWaveformSquare" ng-model="instrument.filterLFOWaveform" ng-change="updateInstrument();" value="square" type="radio">
            <label for="filterLFOWaveformSquare" class="radioLabel">Square</label>
          </span>
          <span class="radioContainer">
            <input id="filterLFOWaveformSaw" ng-model="instrument.filterLFOWaveform" ng-change="updateInstrument();" value="sawtooth" type="radio">
            <label for="filterLFOWaveformSaw" class="radioLabel">Saw</label>
          </span>
          <span class="radioContainer">
            <input id="filterLFOWaveformTriangle" ng-model="instrument.filterLFOWaveform" ng-change="updateInstrument();" value="triangle" type="radio">
            <label for="filterLFOWaveformTriangle" class="radioLabel">Triangle</label>
          </span>
        </span>
      </span>
    </div>
    <div>
      <h2 class="section-header">Envelope</h2>
      <span class="control">
        <label class="control-label">Attack Speed:</label>
        <span class="annotated-input">
          <input ng-model="instrument.envelopeAttack" ng-change="updateInstrument();" type="range" min="0.0" max="0.3" step="0.01" />
          <span>{{instrument.envelopeAttack * 1000}} ms</span>
        </span>
      </span>
      <span class="control">
        <label class="control-label">Decay Speed:</label>
        <span class="annotated-input">
          <input ng-model="instrument.envelopeDecay" ng-change="updateInstrument();" type="range" min="0.0" max="0.3" step="0.01" />
          <span>{{instrument.envelopeDecay * 1000}} ms</span>
        </span>
      </span>
      <span class="control">
        <label class="control-label">Sustain Volume:</label>
        <span class="annotated-input">
          <input ng-model="instrument.envelopeSustain" ng-change="updateInstrument();" type="range" min="0.0" max="1.0" step="0.01" />
          <span>{{(instrument.envelopeSustain * 100) | number:0}}%</span>
        </span>
      </span>
      <span class="control">
        <label class="control-label">Release Speed:</label>
        <span class="annotated-input">
          <input ng-model="instrument.envelopeRelease" ng-change="updateInstrument();" type="range" min="0.0" max="0.3" step="0.01" />
          <span>{{instrument.envelopeRelease * 1000}} ms</span>
        </span>
      </span>
    </div>
  </div>

  <div ng-controller="PatternController">
    <div ng-repeat="pattern in patterns" ng-init="patternIndex = $index">
      <input class="underlinedInput" ng-model="pattern.name" ng-change="updateName();" type="text" />
      <div class="flex">
        <ul class="flex flex-column mt0 ml0 pl0 overflow-scroll-x border-box">
          <li class="flex-uniform-size list-style-none inline-block note-container"><span class="note-column-header">&nbsp;</span></li>
          <li class="flex-uniform-size list-style-none" ng-repeat="track in patterns[patternIndex].tracks">
            <button class="button-small track-button {{$parent.patterns[patternIndex].tracks[$index].muted ? 'enabled' : ''}}" ng-click="toggleTrackMute(patternIndex, $index);">Mute</button>
          </li>
        </ul>
        <ul class="flex flex-column flex-uniform-size mt0 ml0 pl0 overflow-scroll-x border-box">
          <li class="inline-block list-style-none full-width">
            <ul class="ml0 pl0 center no-whitespace-wrap">
              <li class="list-style-none inline-block note-container" ng-repeat="n in [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]">
                <span class="note-column-header">{{n}}</span>
              </li>
            </ul>
          </li>
          <li ng-repeat="track in patterns[patternIndex].tracks" class="inline-block list-style-none full-width">
            <ul class="ml0 pl0 no-whitespace-wrap">
              <li class="list-style-none inline-block note-container" ng-repeat="note in track.notes">
                <input note-input id="track-{{$parent.$index}}-note-{{$index}}" ng-class="{note: true, firstTrack: $parent.$first, lastTrack: $parent.$last, firstNote: $first, lastNote: $last}" ng-model="note.name" ng-change="updateNotes(patternIndex, $parent.$index, $index);" maxlength="4" type="text" />
               </li>
            </ul>
          </li>
        </ul>
        <ul class="flex flex-column mt0 ml0 pl0 overflow-scroll-x border-box">
          <li class="list-style-none flex-uniform-size">&nbsp;</li>
          <li class="list-style-none flex-uniform-size" ng-repeat="track in patterns[patternIndex].tracks">
            <button class="button-small full-width track-button" ng-click="removeTrack(patternIndex, $index);">X</button>
          </li>
        </ul>
      </div>
      <div class="mb1 overflow-auto">
        <button class="block button-full right" ng-click="addTrack(patternIndex);">Add Track</button>
      </div>
    </div>
    <div class="mb1 overflow-auto">
      <button class="block button-full right" ng-click="addPattern();">Add Pattern</button>
    </div>
  </div>

  <div>
    <h2 class="section-header">Sequencer<span class="helperToggleContainer"> - <a class="helperToggle underline" ng-click="show=!show">Tips and Tricks</a></span></h2>
    <ul class="toggleable" ng-show="show">
      <li>A note is a letter between A and G plus an octave between 0 and 7. For example: <b>A3</b>, <b>C♯4</b>, <b>E♭2</b></li>
      <li>Use &lsquo;#&rsquo; to enter a sharp, and a lowercase &lsquo;b&rsquo; to enter a flat</li>
      <li>Use &mdash; to lengthen a note. For example, &lsquo;A4&mdash;&mdash;&mdash;&rsquo; will last for 4 steps, while &lsquo;A4&mdash;&rsquo; will last for two, and &lsquo;A4&rsquo; will last for one.</li>
      <li>Press <code>SPACE</code> to clear the current note</li>
      <li>Use the left/right arrow keys to move between notes, and the up/down arrow keys to move between tracks</li>
    </ul>
  </div>
  <div ng-controller="SequencerController">
    <div class="flex">
      <ul class="flex flex-column mt0 ml0 pl0 overflow-scroll-x border-box">
        <li class="flex-uniform-size list-style-none inline-block note-container"><span class="note-column-header">&nbsp;</span></li>
        <li class="flex-uniform-size list-style-none" ng-repeat="row in patterns">
          <button class="button-small track-button {{row.muted ? 'enabled' : ''}}" ng-click="toggleRowMute($index);">Mute</button>
        </li>
      </ul>
      <ul class="flex flex-column flex-uniform-size mt0 ml0 pl0 overflow-scroll-x border-box">
        <li class="inline-block list-style-none full-width">
          <ul class="ml0 pl0 center no-whitespace-wrap">
            <li class="list-style-none inline-block" style="width: 12.5%;" transport-progress ng-model="currentStep" ng-repeat="n in [1,2,3,4,5,6,7,8,]">
              <span class="inline-block" style="border-radius: 50%; width: 32px;" ng-class="{enabled: currentStep === n}">{{n}}</span>
            </li>
          </ul>
        </li>
        <li ng-repeat="row in patterns" class="inline-block list-style-none full-width">
          <ul class="ml0 pl0 no-whitespace-wrap">
            <li class="inline-block center" style="width: 12.5%;" ng-repeat="pattern in row.patterns" ng-init="sequencerIndex = $index">
              <select ng-model="pattern.patternID" ng-change="changeSequencer(sequencerIndex);" convert-to-number>
                <option ng-repeat="patternOption in patternOptions" value="{{patternOption.id}}">{{patternOption.name}}</option>
              </select>
            </li>
          </ul>
        </li>
      </ul>
      <ul class="flex flex-column mt0 ml0 pl0 overflow-scroll-x border-box">
        <li class="list-style-none flex-uniform-size">&nbsp;</li>
        <li class="list-style-none flex-uniform-size" ng-repeat="row in patterns">
          <button class="button-small full-width track-button" ng-click="removeRow(patternIndex, $index);">X</button>
        </li>
      </ul>
    </div>
    <div class="mb1 overflow-auto">
      <button class="block button-full right" ng-click="addRow();">Add Row</button>
    </div>
  </div>

  <div ng-controller="TransportController">
    <div class="mt2 mb0">
      <h2 class="section-header">Transport</h2>
      <span class="control">
        <label class="control-label">Tempo:</label>
        <span class="annotated-input">
          <input ng-model="tempo" ng-change="updateTempo();" type="range" min="30" max="255" />
          <span>{{tempo}}</span>
        </span>
      </span>
      <span class="control">
        <label class="control-label">Master Volume:</label>
        <span class="annotated-input">
          <input ng-model="amplitude" ng-change="updateAmplitude();" type="range" min="0.0" max="1.0" step="0.01" />
          <span>{{(amplitude * 100) | number:0}}%</span>
        </span>
      </span>
      <div class="mt1 overflow-auto">
        <button class="button-full right {{playing ? 'enabled' : ''}}" ng-click="toggle();">Play</button>
      </div>
      <span class="control mt2">
        <label class="control-label">File Name:</label>
        <span class="annotated-input">
          <input ng-model="downloadFileName" class="underlinedInput" type="text" />
          <span>.wav</span>
        </span>
      </span>
      <div class="mt1 overflow-auto">
        <button class="button-full right" ng-click="export();">Download</button>
        <a id="hidden-download-link" class="display-none" download="output.wav" href=""></a>
      </div>
    </div>
  </div>
</div>
<p class="center mt2 mb2">Made By <a href="http://www.joelstrait.com">Joel Strait</a>, &copy; 2014-16</p>
</body>
</html>
